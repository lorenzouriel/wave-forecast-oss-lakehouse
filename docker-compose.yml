# Main Docker Compose file for Wave Forecast OSS Lakehouse
# This file orchestrates all the services in the lakehouse architecture
#
# Services included:
# - MinIO: S3-compatible object storage (raw, bronze, silver, gold layers)
# - Dremio: Data lakehouse query engine
# - Airbyte: Data integration platform
# - Airflow: Workflow orchestration
# - dbt: Data transformation (Bronze -> Silver -> Gold)
# - Superset: Business intelligence and data visualization
# - Briefer: Collaborative data notebooks and dashboards

networks:
  lakehouse-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

services:
  # MinIO - Object Storage (S3-compatible)
  minio:
    extends:
      file: ./minio/docker-compose.yml
      service: minio
    profiles:
      - minio
      - all

  minio-init:
    extends:
      file: ./minio/docker-compose.yml
      service: minio-init
    profiles:
      - minio
      - all

  # Dremio - Data Lakehouse Query Engine
  dremio:
    extends:
      file: ./dremio/docker-compose.yml
      service: dremio
    profiles:
      - dremio
      - all
    depends_on:
      minio:
        condition: service_healthy

  # Airbyte - Data Integration Platform
  airbyte-db:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-db
    profiles:
      - airbyte
      - all

  airbyte-init:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-init
    profiles:
      - airbyte
      - all

  airbyte-bootloader:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-bootloader
    profiles:
      - airbyte
      - all

  airbyte-server:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-server
    profiles:
      - airbyte
      - all

  airbyte-temporal:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-temporal
    profiles:
      - airbyte
      - all

  airbyte-worker:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-worker
    profiles:
      - airbyte
      - all

  airbyte-webapp:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-webapp
    profiles:
      - airbyte
      - all

  airbyte-connector-builder-server:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-connector-builder-server
    profiles:
      - airbyte
      - all

  airbyte-cron:
    extends:
      file: ./airbyte/docker-compose.yml
      service: airbyte-cron
    profiles:
      - airbyte
      - all

  # Airflow - Workflow Orchestration
  postgres:
    extends:
      file: ./airflow/docker-compose.yml
      service: postgres
    profiles:
      - airflow
      - all

  airflow-apiserver:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-apiserver
    profiles:
      - airflow
      - all

  airflow-scheduler:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-scheduler
    profiles:
      - airflow
      - all

  airflow-dag-processor:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-dag-processor
    profiles:
      - airflow
      - all

  airflow-triggerer:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-triggerer
    profiles:
      - airflow
      - all

  airflow-init:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-init
    profiles:
      - airflow
      - all

  airflow-cli:
    extends:
      file: ./airflow/docker-compose.yml
      service: airflow-cli
    profiles:
      - debug

  # Superset - Business Intelligence & Data Visualization
  superset-db:
    extends:
      file: ./superset/docker-compose.yml
      service: superset-db
    profiles:
      - superset
      - all

  superset-redis:
    extends:
      file: ./superset/docker-compose.yml
      service: superset-redis
    profiles:
      - superset
      - all

  superset:
    extends:
      file: ./superset/docker-compose.yml
      service: superset
    profiles:
      - superset
      - all

  superset-worker:
    extends:
      file: ./superset/docker-compose.yml
      service: superset-worker
    profiles:
      - superset
      - all

  superset-worker-beat:
    extends:
      file: ./superset/docker-compose.yml
      service: superset-worker-beat
    profiles:
      - superset
      - all

  # Briefer - Collaborative Data Notebooks & Dashboards
  briefer-db:
    extends:
      file: ./briefer/docker-compose.yml
      service: briefer-db
    profiles:
      - briefer
      - all

  briefer:
    extends:
      file: ./briefer/docker-compose.yml
      service: briefer
    profiles:
      - briefer
      - all

  # dbt - Data Transformation (Bronze -> Silver -> Gold)
  dbt:
    extends:
      file: ./dbt/docker-compose.yml
      service: dbt
    profiles:
      - dbt
      - all
